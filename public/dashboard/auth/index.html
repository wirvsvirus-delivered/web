<!DOCTYPE html>
<html lang="de" dir="ltr">

<head>

  <!-- Grundlegendes -->
  <meta charset="utf-8">
  <title>delivered Dashboard</title>

  <!-- styling ressourcen & icon -->
  <link rel="shortcut icon" href="../img/favicon.png">
  <link rel="stylesheet" href="../css/master.css">
</head>

<body>

  <!-- Der Loader -->
  <div class="loader-wrapper">
    <div class="loader"></div>
  </div>

  <!-- Das Anmeldeformular -->
  <div class="form-signin-wrapper">
    <form class="form-signin">
      <!-- Titel mit Logo, .heading-class fuer Schriftart -->
      <h1 class="heading">
        <img src="../img/icon.png" alt="delivered">
        Dashboard
      </h1>
      <input required type="email" placeholder="E-Mail-Adresse">
      <input required type="password" placeholder="Passwort">
      <button type="submit">
        Anmelden
        <i class="material-icons md-18">launch</i>
      </button>
    </form>
  </div>

  <!-- BenÃ¶tigte Skripte -->
  <script src="/__/firebase/7.12.0/firebase-app.js"></script>
  <script src="/__/firebase/7.12.0/firebase-auth.js"></script>
  <script src="/__/firebase/init.js"></script>
  <script src="../js/jquery.js"></script>
  <script>

    function dialogue(id, title, content) {
      $('body').append('<div class="modal-wrapper" style="display: flex" id="' +
      id +
      '"><div class="modal"><h2 class="heading">' +
      title +
      '<button style="border-radius: 50%; padding: 4px;float: right; background:#ab1c48" onclick="$(\'#' +
      id +
      '\').remove();"><i class="material-icons md-18">close</i></button></h2>' +
      '<p>' +
      content +
      '</p></div></div>')
    }

    // Wenn du Angemeldet bist, leite weiter zum Dashboard
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        window.location.replace('/dashboard/');
      }
    });

    // Wenn das Formular abgeschickt wird, ...
    $("form").submit(function(event) {
      // Stoppe Neuladen
      event.preventDefault();
      // Zeige Loader
      $('.loader-wrapper').css('display', 'flex');
      firebase.auth().onAuthStateChanged(function(user) {
        // Ueberpruefe Anmeldung
        if (user) {
          // Bleib dauerhaft angemeldet
          firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(function() {
              // .. Und Leite zum Dashboard weiter
              window.location.replace('/dashboard/');
            })
            // Catche evtl.e Fehler
            .catch(function(error) {
              dialogue('persistenceError', 'Fehler: ' + error.code, error.message)
              $('.loader-wrapper').hide();
            });
        } else {
          // Melde dich mit E-Mail und Password an
          firebase.auth().signInWithEmailAndPassword(
            $('input[type="email"]').val(),
            $('input[type="password"]').val()
          ).catch(function(error) {
            dialogue('authError', 'Fehler: ' + error.code, error.message)
            $('.loader-wrapper').hide();
          });
        };
      });
    });
    $(document).on('keydown', function(event) {
      if (event.key == "Escape") {
        $('.modal-wrapper').hide();
      }
    });
  </script>

</body>

</html>
